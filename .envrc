export FZF_CTRL_T_COMMAND='fd --type f --strip-cwd-prefix --hidden --no-ignore --exclude .git'

# Run macos-defaults.sh if its contents have changed
watch_file macos-defaults.sh
MACOS_DEFAULTS_HASH=$(shasum macos-defaults.sh | cut -d' ' -f1)
MACOS_DEFAULTS_HASH_FILE="$(direnv_layout_dir)/macos_defaults_hash"
mkdir -p "$(dirname "$MACOS_DEFAULTS_HASH_FILE")"
if [ ! -f "$MACOS_DEFAULTS_HASH_FILE" ] || [ "$MACOS_DEFAULTS_HASH" != "$(cat "$MACOS_DEFAULTS_HASH_FILE")" ]; then
  echo "macos-defaults.sh changed or not yet applied. Running..."
  ./macos-defaults.sh
  echo "$MACOS_DEFAULTS_HASH" > "$MACOS_DEFAULTS_HASH_FILE"
fi

# Auto-install Brewfile if changed
watch_file Brewfile
BREWFILE_HASH=$(shasum Brewfile | cut -d' ' -f1)
BREWFILE_HASH_FILE="$(direnv_layout_dir)/brewfile_hash"
mkdir -p "$(dirname "$BREWFILE_HASH_FILE")"
if [ ! -f "$BREWFILE_HASH_FILE" ] || [ "$BREWFILE_HASH" != "$(cat "$BREWFILE_HASH_FILE")" ]; then
  echo "Brewfile changed or not yet installed. Running brew bundle..."
  brew bundle --file=Brewfile
  echo "$BREWFILE_HASH" > "$BREWFILE_HASH_FILE"
fi
